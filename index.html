<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade Calculator</title>
    <style>
        /* --- CSS VARIABLES (THEMING) --- */
        :root {
            --bg-color: #f4f7f6;
            --container-bg: #ffffff;
            --text-main: #333333;
            --text-secondary: #555555;
            --text-muted: #7f8c8d;
            --heading-color: #2c3e50;
            --border-color: #ecf0f1;
            --th-bg: #f8f9fa;
            --input-bg: #ffffff;
            --input-border: #cccccc;
            --input-text: #333333;
            --accent-color: #3498db;
            --accent-hover: #2980b9;
            --percent-text: #2980b9;
            --delete-btn: #e74c3c;
            --delete-hover: #c0392b;
            --result-box-bg: #ecf0f1;
            --goal-box-bg: #e8f6f3;
            --goal-border: #1abc9c;
            --shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        [data-theme="dark"] {
            --bg-color: #121212;
            --container-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --text-secondary: #b0b0b0;
            --text-muted: #a0a0a0;
            --heading-color: #ffffff;
            --border-color: #333333;
            --th-bg: #2c2c2c;
            --input-bg: #2d2d2d;
            --input-border: #444444;
            --input-text: #ffffff;
            --accent-color: #3498db;
            --accent-hover: #5dade2;
            --percent-text: #5dade2;
            --delete-btn: #cf6679;
            --delete-hover: #b00020;
            --result-box-bg: #2d2d2d;
            --goal-box-bg: #1a3a34; /* Darker teal for dark mode */
            --goal-border: #16a085;
            --shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            background-color: var(--container-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 900px;
            transition: background-color 0.3s;
        }

        /* --- HEADER --- */
        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
        }

        h2 { margin: 0; color: var(--heading-color); }
        .report-date { display: none; }

        .theme-toggle {
            background: none;
            border: 1px solid var(--border-color);
            color: var(--text-main);
            font-size: 20px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 50%;
            transition: all 0.3s;
        }
        .theme-toggle:hover { background-color: var(--th-bg); }

        /* --- TABLE --- */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th {
            text-align: left;
            padding: 12px;
            background-color: var(--th-bg);
            color: var(--text-secondary);
            font-weight: 600;
            border-bottom: 2px solid var(--border-color);
        }

        td {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }

        /* --- INPUTS --- */
        input[type="text"], input[type="number"], select {
            padding: 8px;
            border: 1px solid var(--input-border);
            background-color: var(--input-bg);
            color: var(--input-text);
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
            font-size: 14px;
        }

        input[type="number"] { text-align: right; }
        .category-input { width: 200px; }
        .num-input { width: 80px; }
        
        .row-percent {
            font-weight: bold;
            color: var(--percent-text);
            text-align: right;
        }

        /* --- CONTROLS --- */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-top: 20px;
        }

        .buttons-left { display: flex; gap: 10px; }

        button.btn-std {
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
            color: white;
        }

        button.add-btn { background-color: var(--accent-color); }
        button.add-btn:hover { background-color: var(--accent-hover); }

        button.export-btn { background-color: #27ae60; }
        button.export-btn:hover { background-color: #2ecc71; }

        button.delete-btn {
            background-color: var(--delete-btn);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }
        button.delete-btn:hover { background-color: var(--delete-hover); }

        /* --- RESULT BOX --- */
        .result-box {
            text-align: right;
            background-color: var(--result-box-bg);
            padding: 15px;
            border-radius: 8px;
            min-width: 200px;
        }

        .result-box div { margin-bottom: 5px; font-size: 14px; color: var(--text-muted); }
        .final-grade { font-size: 24px; font-weight: bold; color: var(--heading-color); }
        .total-weight-warning { color: #e67e22; font-weight: bold; }

        /* --- GOAL CALCULATOR SECTION --- */
        .goal-section {
            margin-top: 30px;
            padding: 20px;
            background-color: var(--goal-box-bg);
            border-left: 5px solid var(--goal-border);
            border-radius: 4px;
        }
        
        .goal-section h3 {
            margin-top: 0;
            color: var(--text-main);
            font-size: 18px;
        }

        .goal-controls {
            display: flex;
            gap: 15px;
            align-items: flex-end;
            flex-wrap: wrap;
        }

        .goal-input-group {
            display: flex;
            flex-direction: column;
        }
        
        .goal-input-group label {
            font-size: 12px;
            margin-bottom: 5px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        button.calc-goal-btn {
            background-color: var(--goal-border);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            height: 35px;
        }
        button.calc-goal-btn:hover { opacity: 0.9; }

        .goal-result {
            margin-top: 15px;
            font-weight: bold;
            color: var(--text-main);
            font-size: 16px;
        }

        /* --- PRINT / PDF EXPORT STYLES --- */
        @media print {
            .buttons-left, .delete-btn, .theme-toggle, th:last-child, td:last-child, .goal-section {
                display: none !important;
            }

            body { background-color: white !important; color: black !important; padding: 0 !important; }
            .container { box-shadow: none !important; max-width: 100% !important; padding: 20px !important; border: none !important; }
            .header-row { border-bottom: 2px solid #333 !important; margin-bottom: 30px !important; display: block !important; }
            h2 { color: black !important; font-size: 28px !important; margin-bottom: 5px !important; }
            .report-date { display: block !important; color: #666 !important; font-size: 14px !important; }
            
            table { border: 1px solid #ccc !important; width: 100% !important; }
            th { background-color: #e0e0e0 !important; color: black !important; border: 1px solid #ccc !important; padding: 10px !important; text-transform: uppercase !important; font-size: 12px !important; }
            td { border: 1px solid #ccc !important; padding: 10px !important; color: black !important; }
            tr:nth-child(even) td { background-color: #f9f9f9 !important; }
            
            input { border: none !important; background: transparent !important; color: black !important; padding: 0 !important; font-weight: 500; font-family: inherit !important; font-size: 14px !important; }
            td:not(:first-child) input, th:not(:first-child), .row-percent { text-align: center !important; }
            
            .controls { display: block !important; margin-top: 30px !important; }
            .result-box { background-color: white !important; border: 2px solid #333 !important; color: black !important; padding: 20px !important; width: 300px !important; float: right !important; }
            .result-box div { color: black !important; font-size: 16px !important; }
            .final-grade { color: black !important; font-size: 32px !important; margin-top: 10px !important; }
            .row-percent { color: black !important; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-row">
        <div>
            <h2>Course Grade Report</h2>
            <div class="report-date" id="reportDate"></div>
        </div>
        <button class="theme-toggle" id="themeBtn" onclick="toggleTheme()" title="Toggle Dark/Light Mode">‚òÄÔ∏è</button>
    </div>
    
    <table id="gradeTable">
        <thead>
            <tr>
                <th>Category Name</th>
                <th>Points Earned</th>
                <th>Total Points</th>
                <th>Current %</th>
                <th>Weight (%)</th>
                <th></th>
            </tr>
        </thead>
        <tbody id="tableBody">
            </tbody>
    </table>

    <div class="controls">
        <div class="buttons-left">
            <button class="btn-std add-btn" onclick="addRow()">+ Add Category</button>
            <button class="btn-std export-btn" onclick="window.print()">Export PDF</button>
        </div>
        
        <div class="result-box">
            <div id="weightDisplay">Total Weight: 0%</div>
            <div>Final Grade:</div>
            <div class="final-grade" id="finalGrade">0.00%</div>
        </div>
    </div>

    <div class="goal-section">
        <h3>üèÜ Goal Calculator</h3>
        <div class="goal-controls">
            <div class="goal-input-group">
                <label>Target Grade (%)</label>
                <input type="number" id="targetGrade" placeholder="90" style="width: 100px;">
            </div>
            <div class="goal-input-group">
                <label>Calculate For Category</label>
                <select id="goalCategorySelect" onmousedown="updateGoalDropdown()" style="width: 250px;">
                    <option value="">Select a category...</option>
                </select>
            </div>
            <button class="calc-goal-btn" onclick="calculateGoal()">Calculate Needed Score</button>
        </div>
        <div class="goal-result" id="goalResult"></div>
    </div>

</div>

<script>
    document.getElementById('reportDate').innerText = new Date().toLocaleDateString();

    /* --- THEME LOGIC --- */
    function initTheme() {
        const savedTheme = localStorage.getItem('theme');
        const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (savedTheme === 'dark' || (!savedTheme && systemPrefersDark)) {
            document.documentElement.setAttribute('data-theme', 'dark');
            document.getElementById('themeBtn').innerText = 'üåô';
        } else {
            document.documentElement.setAttribute('data-theme', 'light');
            document.getElementById('themeBtn').innerText = '‚òÄÔ∏è';
        }
    }

    function toggleTheme() {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        document.getElementById('themeBtn').innerText = newTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
    }

    /* --- CALCULATOR LOGIC --- */
    const tableBody = document.getElementById('tableBody');
    const finalGradeDisplay = document.getElementById('finalGrade');
    const weightDisplay = document.getElementById('weightDisplay');

    function initCalculator() {
        addRow();
        addRow();
        addRow();
        calculate();
        updateGoalDropdown();
    }

    function addRow() {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td><input type="text" class="category-input" placeholder="Category Name" onchange="updateGoalDropdown()"></td>
            <td><input type="number" class="num-input earned" placeholder="0" oninput="calculate()"></td>
            <td><input type="number" class="num-input max" placeholder="0" oninput="calculate()"></td>
            <td class="row-percent">0.00%</td>
            <td><input type="number" class="num-input weight" placeholder="0" oninput="calculate()"></td>
            <td><button class="delete-btn" onclick="removeRow(this)">√ó</button></td>
        `;
        tableBody.appendChild(row);
    }

    function removeRow(btn) {
        btn.closest('tr').remove();
        calculate();
        updateGoalDropdown();
    }

    function calculate() {
        let totalWeightedScore = 0;
        let totalWeight = 0;
        const rows = document.querySelectorAll('#tableBody tr');

        rows.forEach(row => {
            const earned = parseFloat(row.querySelector('.earned').value) || 0;
            const max = parseFloat(row.querySelector('.max').value) || 0;
            const weight = parseFloat(row.querySelector('.weight').value) || 0;
            const percentDisplay = row.querySelector('.row-percent');

            if (max > 0) {
                const p = (earned / max) * 100;
                percentDisplay.innerText = p.toFixed(2) + '%';
            } else {
                percentDisplay.innerText = 'N/A';
            }

            if (max > 0) {
                totalWeightedScore += (earned / max) * weight;
                totalWeight += weight;
            } else if (weight > 0 && max === 0) {
                totalWeight += weight;
            }
        });

        weightDisplay.innerText = `Total Weight: ${totalWeight}%`;
        
        if (totalWeight !== 100 && totalWeight !== 0) {
            weightDisplay.classList.add('total-weight-warning');
        } else {
            weightDisplay.classList.remove('total-weight-warning');
        }

        finalGradeDisplay.innerText = totalWeightedScore.toFixed(2) + '%';
    }

    /* --- GOAL SEEKING LOGIC --- */
    function updateGoalDropdown() {
        const select = document.getElementById('goalCategorySelect');
        const rows = document.querySelectorAll('#tableBody tr');
        
        // Save current selection to restore after rebuild
        const currentVal = select.value;

        // Clear existing options
        select.innerHTML = '<option value="">Select a category...</option>';

        rows.forEach((row, index) => {
            const nameInput = row.querySelector('.category-input').value;
            const label = nameInput.trim() !== "" ? nameInput : `Row ${index + 1}`;
            const option = document.createElement('option');
            option.value = index;
            option.text = label;
            select.appendChild(option);
        });

        select.value = currentVal;
    }

    function calculateGoal() {
        const target = parseFloat(document.getElementById('targetGrade').value);
        const selectedIndex = document.getElementById('goalCategorySelect').value;
        const resultDiv = document.getElementById('goalResult');

        if (isNaN(target)) {
            resultDiv.innerHTML = "Please enter a valid target grade percentage.";
            return;
        }
        if (selectedIndex === "") {
            resultDiv.innerHTML = "Please select a category to calculate for.";
            return;
        }

        // --- THE MATH ---
        // Formula: Target = (Sum of OTHER weighted scores) + (Needed / Max * Weight)
        // Therefore: Needed = ((Target - OtherSums) / Weight) * Max

        let sumOfOthers = 0;
        let targetMax = 0;
        let targetWeight = 0;
        let targetName = "";

        const rows = document.querySelectorAll('#tableBody tr');
        
        // Loop through rows to separate the Target from the Others
        rows.forEach((row, index) => {
            const earned = parseFloat(row.querySelector('.earned').value) || 0;
            const max = parseFloat(row.querySelector('.max').value) || 0;
            const weight = parseFloat(row.querySelector('.weight').value) || 0;

            if (index == selectedIndex) {
                // This is our variable row
                targetMax = max;
                targetWeight = weight;
                targetName = row.querySelector('.category-input').value || "Selected Category";
            } else {
                // This is a fixed row
                if (max > 0) {
                    sumOfOthers += (earned / max) * weight;
                }
            }
        });

        // Validation
        if (targetWeight === 0) {
            resultDiv.innerHTML = `Category <strong>${targetName}</strong> has no weight (0%). Please enter a weight first.`;
            return;
        }
        if (targetMax === 0) {
            resultDiv.innerHTML = `Category <strong>${targetName}</strong> has 0 total points. Please enter Max Points first.`;
            return;
        }

        // Calculation
        // Step 1: Calculate the weighted points needed from this specific category
        const weightedPointsNeeded = target - sumOfOthers;
        
        // Step 2: Convert weighted points back to raw points
        // NeededPoints = (WeightedPointsNeeded / Weight) * MaxPoints
        const pointsNeeded = (weightedPointsNeeded / targetWeight) * targetMax;

        const percentageNeeded = (pointsNeeded / targetMax) * 100;

        // Display
        resultDiv.innerHTML = `
            To get a <strong>${target}%</strong> overall, you need:<br>
            <span style="font-size: 1.2em; color: var(--accent-hover);">
                ${pointsNeeded.toFixed(2)} / ${targetMax} points (${percentageNeeded.toFixed(2)}%)
            </span>
            <br>on <em>${targetName}</em>.
        `;
    }

    initTheme();
    initCalculator();

</script>

</body>
</html>